---
import AdminLayout from '../../layouts/AdminLayout.astro';
import AdminGuard from '../../components/AdminGuard.astro';
---

<AdminLayout title="User Management - DevExpress">
  <AdminGuard>
    <div class="space-y-6">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">User Management</h1>
        <p class="text-gray-600 mt-2">View and manage all registered users</p>
      </div>

      <!-- Search and Filters -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <!-- Search -->
          <div class="md:col-span-2">
            <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Search Users</label>
            <div class="relative">
              <input
                type="text"
                id="search"
                placeholder="Search by name, email, or company..."
                class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
              />
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Role Filter -->
          <div>
            <label for="role-filter" class="block text-sm font-medium text-gray-700 mb-2">Role</label>
            <select id="role-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
              <option value="">All Roles</option>
              <option value="customer">Customer</option>
              <option value="admin">Admin</option>
              <option value="developer">Developer</option>
              <option value="support">Support</option>
            </select>
          </div>

          <!-- Status Filter -->
          <div>
            <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
            <select id="status-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
              <option value="">All Statuses</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
              <option value="suspended">Suspended</option>
              <option value="pending_verification">Pending Verification</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Users Table -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-medium text-gray-900">All Users</h3>
            <div class="flex items-center space-x-3">
                             <span id="users-count" class="text-sm text-gray-500">No users</span>
              <button id="add-user-btn" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                Add User
              </button>
            </div>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Login</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody id="users-tbody" class="bg-white divide-y divide-gray-200">
              <!-- Users will be populated here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Add/Edit User Modal -->
      <div id="user-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-gray-600 bg-opacity-75"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
          <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl">
              <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="flex items-center justify-between mb-4">
                  <h3 id="modal-title" class="text-lg font-medium text-gray-900">Add New User</h3>
                  <button id="close-modal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
                
                <form id="user-form" class="space-y-4">
                  <input type="hidden" id="user-id" />
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                      <input
                        type="text"
                        id="full-name"
                        name="full-name"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                    
                    <div>
                      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                      <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                      <input
                        type="tel"
                        id="phone"
                        name="phone"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                    
                    <div>
                      <label for="company-name" class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                      <input
                        type="text"
                        id="company-name"
                        name="company-name"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                      <select
                        id="role"
                        name="role"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      >
                        <option value="customer">Customer</option>
                        <option value="admin">Admin</option>
                        <option value="developer">Developer</option>
                        <option value="support">Support</option>
                      </select>
                    </div>
                    
                    <div>
                      <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                      <select
                        id="status"
                        name="status"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      >
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="suspended">Suspended</option>
                        <option value="pending_verification">Pending Verification</option>
                      </select>
                    </div>
                  </div>

                  <div id="password-section" class="space-y-4">
                    <div>
                      <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                      <input
                        type="password"
                        id="password"
                        name="password"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                    
                    <div>
                      <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                      <input
                        type="password"
                        id="confirm-password"
                        name="confirm-password"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                  </div>

                  <div class="flex justify-end space-x-3 pt-4">
                    <button
                      type="button"
                      id="cancel-btn"
                      class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      id="save-btn"
                      class="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md hover:bg-primary-700"
                    >
                      Save User
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Details Modal -->
      <div id="user-details-modal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-gray-600 bg-opacity-75"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
          <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
              <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="flex items-center justify-between mb-4">
                  <h3 id="details-modal-title" class="text-lg font-medium text-gray-900">User Details</h3>
                  <button id="close-details-modal" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
                
                <div id="user-details-content" class="space-y-6">
                  <!-- User details will be populated here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </AdminGuard>
</AdminLayout>

<script>
  import { adminDataStore } from '../../lib/admin-data';

  let currentUsers: any[] = [];
  let filteredUsers: any[] = [];
  let isEditing = false;

  // Initialize users page
  function initializeUsersPage() {
    loadUsers();
    setupEventListeners();
  }

  // Load all users
  function loadUsers() {
    try {
      currentUsers = adminDataStore.getUsers();
      filteredUsers = [...currentUsers];
      renderUsers();
      updateUsersCount();
    } catch (error) {
      console.error('Error loading users:', error);
    }
  }

  // Render users in table
  function renderUsers() {
    const tbody = document.getElementById('users-tbody');
    if (!tbody) return;

    if (filteredUsers.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="px-6 py-12 text-center text-gray-500">
            <div class="flex flex-col items-center">
              <svg class="w-12 h-12 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
              <p class="text-lg font-medium text-gray-900 mb-2">No users found</p>
              <p class="text-gray-500">Try adjusting your search or filters</p>
            </div>
          </td>
        </tr>
      `;
      return;
    }

    tbody.innerHTML = filteredUsers.map(user => `
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center mr-3">
              <span class="text-sm font-medium text-primary-600">${user.fullName.charAt(0)}</span>
            </div>
            <div>
              <div class="text-sm font-medium text-gray-900">${user.fullName}</div>
              <div class="text-sm text-gray-500">${user.email}</div>
              ${user.companyName ? `<div class="text-xs text-gray-400">${user.companyName}</div>` : ''}
            </div>
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full ${getRoleColor(user.role)}">
            ${user.role}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(user.status)}">
            ${user.status.replace('_', ' ')}
          </span>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          ${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleDateString() : 'Never'}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
          ${new Date(user.createdAt).toLocaleDateString()}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <div class="flex space-x-2">
            <button 
              onclick="viewUser('${user.id}')"
              class="text-primary-600 hover:text-primary-900"
            >
              View
            </button>
            <button 
              onclick="editUser('${user.id}')"
              class="text-green-600 hover:text-green-900"
            >
              Edit
            </button>
            <button 
              onclick="deleteUser('${user.id}')"
              class="text-red-600 hover:text-red-900"
            >
              Delete
            </button>
          </div>
        </td>
      </tr>
    `).join('');
  }

  // Update users count
  function updateUsersCount() {
    const countElement = document.getElementById('users-count');
    if (countElement) {
      countElement.textContent = `Showing ${filteredUsers.length} of ${currentUsers.length} users`;
    }
  }

  // Get role color
  function getRoleColor(role: string) {
    const colors = {
      'customer': 'bg-blue-100 text-blue-800',
      'admin': 'bg-red-100 text-red-800',
      'developer': 'bg-purple-100 text-purple-800',
      'support': 'bg-green-100 text-green-800'
    };
    return colors[role as keyof typeof colors] || 'bg-gray-100 text-gray-800';
  }

  // Get status color
  function getStatusColor(status: string) {
    const colors = {
      'active': 'bg-green-100 text-green-800',
      'inactive': 'bg-gray-100 text-gray-800',
      'suspended': 'bg-red-100 text-red-800',
      'pending_verification': 'bg-yellow-100 text-yellow-800'
    };
    return colors[status as keyof typeof colors] || 'bg-gray-100 text-gray-800';
  }

  // Search and filter users
  function filterUsers() {
    const searchQuery = (document.getElementById('search') as HTMLInputElement).value.toLowerCase();
    const roleFilter = (document.getElementById('role-filter') as HTMLSelectElement).value;
    const statusFilter = (document.getElementById('status-filter') as HTMLSelectElement).value;

    filteredUsers = currentUsers.filter(user => {
      // Search filter
      const matchesSearch = 
        user.fullName.toLowerCase().includes(searchQuery) ||
        user.email.toLowerCase().includes(searchQuery) ||
        (user.companyName && user.companyName.toLowerCase().includes(searchQuery));

      // Role filter
      const matchesRole = !roleFilter || user.role === roleFilter;

      // Status filter
      const matchesStatus = !statusFilter || user.status === statusFilter;

      return matchesSearch && matchesRole && matchesStatus;
    });

    renderUsers();
    updateUsersCount();
  }

  // Add new user
  function addUser() {
    isEditing = false;
    resetUserForm();
    showUserModal('Add New User');
  }

  // Edit existing user
  function editUser(userId: string) {
    const user = adminDataStore.getUserById(userId);
    if (!user) return;

    isEditing = true;
    populateUserForm(user);
    showUserModal('Edit User');
  }

  // View user details
  function viewUser(userId: string) {
    const user = adminDataStore.getUserById(userId);
    if (!user) return;

    const modal = document.getElementById('user-details-modal');
    const modalTitle = document.getElementById('details-modal-title');
    const modalContent = document.getElementById('user-details-content');

    if (modal && modalTitle && modalContent) {
      modalTitle.textContent = `User Details - ${user.fullName}`;
      
      modalContent.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- User Information -->
          <div class="space-y-4">
            <h4 class="text-md font-medium text-gray-900">User Information</h4>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Full Name:</span>
                <span class="text-sm font-medium text-gray-900">${user.fullName}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Email:</span>
                <span class="text-sm font-medium text-gray-900">${user.email}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Phone:</span>
                <span class="text-sm font-medium text-gray-900">${user.phone || 'Not provided'}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Company:</span>
                <span class="text-sm font-medium text-gray-900">${user.companyName || 'Not provided'}</span>
              </div>
            </div>
          </div>

          <!-- Account Information -->
          <div class="space-y-4">
            <h4 class="text-md font-medium text-gray-900">Account Information</h4>
            <div class="space-y-2">
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Role:</span>
                <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full ${getRoleColor(user.role)}">
                  ${user.role}
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Status:</span>
                <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(user.status)}">
                  ${user.status.replace('_', ' ')}
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Login Count:</span>
                <span class="text-sm font-medium text-gray-900">${user.loginCount}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-sm text-gray-500">Last Login:</span>
                <span class="text-sm font-medium text-gray-900">${user.lastLoginAt ? new Date(user.lastLoginAt).toLocaleString() : 'Never'}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Activity Information -->
        <div class="space-y-4">
          <h4 class="text-md font-medium text-gray-900">Activity Information</h4>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Created:</span>
              <span class="text-sm font-medium text-gray-900">${new Date(user.createdAt).toLocaleString()}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Last Updated:</span>
              <span class="text-sm font-medium text-gray-900">${new Date(user.updatedAt).toLocaleString()}</span>
            </div>
          </div>
        </div>
      `;

      modal.classList.remove('hidden');
    }
  }

  // Delete user
  function deleteUser(userId: string) {
    if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
      return;
    }

    try {
      const success = adminDataStore.deleteUser(userId);
      if (success) {
        loadUsers();
        alert('User deleted successfully!');
      } else {
        alert('Failed to delete user');
      }
    } catch (error) {
      alert('Failed to delete user');
      console.error('Error deleting user:', error);
    }
  }

  // Show user modal
  function showUserModal(title: string) {
    const modal = document.getElementById('user-modal');
    const modalTitle = document.getElementById('modal-title');
    const passwordSection = document.getElementById('password-section');

    if (modal && modalTitle && passwordSection) {
      modalTitle.textContent = title;
      
      // Show password fields for new users
      if (!isEditing) {
        passwordSection.style.display = 'block';
        (document.getElementById('password') as HTMLInputElement).required = true;
        (document.getElementById('confirm-password') as HTMLInputElement).required = true;
      } else {
        passwordSection.style.display = 'none';
        (document.getElementById('password') as HTMLInputElement).required = false;
        (document.getElementById('confirm-password') as HTMLInputElement).required = false;
      }

      modal.classList.remove('hidden');
    }
  }

  // Hide user modal
  function hideUserModal() {
    document.getElementById('user-modal')?.classList.add('hidden');
  }

  // Reset user form
  function resetUserForm() {
    const form = document.getElementById('user-form') as HTMLFormElement;
    if (form) {
      form.reset();
      (document.getElementById('user-id') as HTMLInputElement).value = '';
    }
  }

  // Populate user form for editing
  function populateUserForm(user: any) {
    (document.getElementById('user-id') as HTMLInputElement).value = user.id;
    (document.getElementById('full-name') as HTMLInputElement).value = user.fullName;
    (document.getElementById('email') as HTMLInputElement).value = user.email;
    (document.getElementById('phone') as HTMLInputElement).value = user.phone || '';
    (document.getElementById('company-name') as HTMLInputElement).value = user.companyName || '';
    (document.getElementById('role') as HTMLSelectElement).value = user.role;
    (document.getElementById('status') as HTMLSelectElement).value = user.status;
  }

  // Handle user form submission
  function handleUserFormSubmit(e: Event) {
    e.preventDefault();

    const formData = new FormData(e.target as HTMLFormElement);
    const userId = (document.getElementById('user-id') as HTMLInputElement).value;
    
    const userData = {
      fullName: formData.get('full-name') as string,
      email: formData.get('email') as string,
      phone: formData.get('phone') as string,
      companyName: formData.get('company-name') as string,
      role: formData.get('role') as string,
      status: formData.get('status') as string
    };

    // Validate required fields
    if (!userData.fullName || !userData.email) {
      alert('Please fill in all required fields');
      return;
    }

    // Validate password for new users
    if (!isEditing) {
      const password = formData.get('password') as string;
      const confirmPassword = formData.get('confirm-password') as string;
      
      if (!password || password !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
    }

    try {
      if (isEditing) {
        // Update existing user
        const updatedUser = adminDataStore.updateUser(userId, userData);
        if (updatedUser) {
          alert('User updated successfully!');
          hideUserModal();
          loadUsers();
        }
      } else {
        // Add new user (this would need to be implemented in the data store)
        alert('User creation not implemented in this demo');
      }
    } catch (error) {
      alert('Failed to save user');
      console.error('Error saving user:', error);
    }
  }

  // Setup event listeners
  function setupEventListeners() {
    // Search and filter inputs
    document.getElementById('search')?.addEventListener('input', filterUsers);
    document.getElementById('role-filter')?.addEventListener('change', filterUsers);
    document.getElementById('status-filter')?.addEventListener('change', filterUsers);

    // Add user button
    document.getElementById('add-user-btn')?.addEventListener('click', addUser);

    // User form
    document.getElementById('user-form')?.addEventListener('submit', handleUserFormSubmit);

    // Modal close buttons
    document.getElementById('close-modal')?.addEventListener('click', hideUserModal);
    document.getElementById('cancel-btn')?.addEventListener('click', hideUserModal);
    document.getElementById('close-details-modal')?.addEventListener('click', () => {
      document.getElementById('user-details-modal')?.classList.add('hidden');
    });

    // Close modals when clicking outside
    document.getElementById('user-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        (e.currentTarget as HTMLElement).classList.add('hidden');
      }
    });

    document.getElementById('user-details-modal')?.addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        (e.currentTarget as HTMLElement).classList.add('hidden');
      }
    });
  }

  // Initialize page when DOM loads
  document.addEventListener('DOMContentLoaded', initializeUsersPage);

  // Make functions globally available for onclick handlers
  (window as any).viewUser = viewUser;
  (window as any).editUser = editUser;
  (window as any).deleteUser = deleteUser;
</script>
