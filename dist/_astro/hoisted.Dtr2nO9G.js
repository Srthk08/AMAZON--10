import{s as h}from"./shared-data-store.BLbwHvcf.js";import{s as v}from"./supabase.ASU9rNY7.js";import"./hoisted.UJltcVt3.js";import"./index.BFAZBQoJ.js";console.log("üöÄ Cart page script loaded");document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM Content Loaded - Cart page initialization starting..."),["empty-cart","cart-items","cart-actions","project-requirements","cart-content"].forEach(e=>{const o=document.getElementById(e);console.log(`üîç Element ${e}:`,!!o)});try{console.log("üîç Creating Cart instance...");const e=new P;console.log("‚úÖ Cart created, items count:",e.items.length),console.log("‚úÖ Cart initialized with",e.items.length,"items");const o=document.getElementById("cart-content");o&&(o.style.display="block",o.style.visibility="visible",console.log("‚úÖ Forced cart content to be visible")),document.getElementById("submit-requirements")?.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),e.submitRequirements()}),document.getElementById("requirements-form")?.addEventListener("submit",r=>(r.preventDefault(),r.stopPropagation(),!1))}catch(e){console.error("‚ùå Error initializing cart:",e),alert("Error initializing cart: "+e.message)}});class P{constructor(){this.items=[],this.requirements={},this.currentSharedOrderId=null,this.debouncedSaveToSupabase=this.debounce(this.saveCartToSupabase.bind(this),1e3),this.init()}init(){this.loadCart(),this.checkUrlParams(),this.renderCart(),this.bindEvents()}checkUrlParams(){const e=new URLSearchParams(window.location.search),o=e.get("product"),t=e.get("price");o&&t&&(this.addProductFromUrl(o,parseInt(t)),window.history.replaceState({},document.title,window.location.pathname))}addProductFromUrl(e,o){this.items=[];const t={"restaurant-menu":"Restaurant Menu System","android-tv":"Android TV App","mobile-streaming":"Mobile Streaming App"},n={"restaurant-menu":"Digital menu system with QR code ordering, real-time updates, and analytics dashboard.","android-tv":"Custom Android TV application with streaming capabilities and smart remote support.","mobile-streaming":"Cross-platform mobile app for video streaming with offline download support."},r={id:e,name:t[e]||"Custom Product",description:n[e]||"Professional digital solution",price:o,quantity:1,customName:"",logo:null,color:"#3B82F6",features:[]};this.items.push(r),this.saveCart()}loadCart(){const e=localStorage.getItem("cart-items");e&&(this.items=JSON.parse(e))}saveCart(){localStorage.setItem("cart-items",JSON.stringify(this.items))}addItem(e){this.items.length>0&&(this.items=[]),this.items.push({...e,quantity:1,customName:"",logo:null,color:"#3B82F6",features:[]}),this.saveCart(),this.renderCart()}removeItem(e){this.items=this.items.filter(o=>o.id!==e),this.saveCart(),this.renderCart()}updateItem(e,o){const t=this.items.find(n=>n.id===e);t&&(Object.assign(t,o),this.saveCart(),this.renderCart())}renderCart(){console.log("üé® renderCart called with items:",this.items.length);const e=document.getElementById("empty-cart"),o=document.getElementById("cart-items"),t=document.getElementById("cart-actions"),n=document.getElementById("project-requirements"),r=document.getElementById("cart-content");console.log("üîç DOM elements found:",{emptyCart:!!e,cartItems:!!o,cartActions:!!t,projectRequirements:!!n,cartContent:!!r}),this.items.length===0?(console.log("üì≠ Showing empty cart"),e?.classList.remove("hidden"),o?.classList.add("hidden"),t?.classList.add("hidden"),n?.classList.add("hidden")):(console.log("üì¶ Showing cart with items"),e?.classList.add("hidden"),o?.classList.remove("hidden"),t?.classList.remove("hidden"),n?.classList.add("hidden")),this.renderCartItems(),this.updateSummary()}renderCartItems(){const e=document.getElementById("cart-items");e&&(e.innerHTML="",this.items.forEach(o=>{const t=this.createCartItemElement(o);e.appendChild(t)}))}createCartItemElement(e){const o=document.getElementById("cart-item-template");if(!o)return document.createElement("div");const t=o.cloneNode(!0);t.classList.remove("hidden"),t.id=`cart-item-${e.id}`,t.querySelector(".product-name").textContent=e.name,t.querySelector(".product-description").textContent=e.description,t.querySelector(".product-price").textContent=`‚Çπ${e.price}`;const n=t.querySelector(".product-type-text"),r=t.querySelector(".product-type-badge");e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"?(n.textContent="Restaurant Solution",r.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-green-100 text-green-800"):e.id==="android-tv"||e.id==="android-tv-app"?(n.textContent="Android TV App",r.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-purple-100 text-purple-800"):e.id==="mobile-streaming"||e.id==="streaming-mobile-app"?(n.textContent="Mobile Streaming App",r.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-orange-100 text-orange-800"):(n.textContent="Custom Product",r.className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium product-type-badge bg-blue-100 text-blue-800");const s=t.querySelector("#restaurant-name-customization");e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"?s?.classList.remove("hidden"):s?.classList.add("hidden");const a=t.querySelector(".product-name-input");a&&e.customName&&(a.value=e.customName);const i=t.querySelector(".restaurant-name-input");return i&&e.restaurantName&&(i.value=e.restaurantName),t.querySelectorAll(".color-option").forEach(d=>{d.dataset.color===e.color&&d.classList.add("border-2","border-gray-900")}),t.querySelectorAll(".feature-checkbox").forEach(d=>{e.features.includes(d.dataset.feature)&&(d.checked=!0)}),this.bindItemEvents(t,e),t}bindItemEvents(e,o){e.querySelector(".product-name-input")?.addEventListener("input",l=>{this.updateItem(o.id,{customName:l.target.value})}),e.querySelector(".restaurant-name-input")?.addEventListener("input",l=>{this.updateItem(o.id,{restaurantName:l.target.value})});const r=e.querySelector(".logo-upload"),s=e.querySelector(".logo-upload-btn"),a=e.querySelector(".logo-preview");s.addEventListener("click",()=>r.click()),r.addEventListener("change",l=>{const d=l.target.files[0];if(d){const u=new FileReader;u.onload=m=>{a.innerHTML=`<img src="${m.target.result}" class="w-full h-full object-cover rounded-lg">`,this.updateItem(o.id,{logo:m.target.result})},u.readAsDataURL(d)}});const i=e.querySelectorAll(".color-option");i.forEach(l=>{l.addEventListener("click",()=>{i.forEach(d=>d.classList.remove("border-2","border-gray-900")),l.classList.add("border-2","border-gray-900"),this.updateItem(o.id,{color:l.dataset.color})})});const c=e.querySelectorAll(".feature-checkbox");c.forEach(l=>{l.addEventListener("change",()=>{const d=Array.from(c).filter(u=>u.checked).map(u=>u.dataset.feature);this.updateItem(o.id,{features:d})})})}updateSummary(){const e=this.items.reduce((l,d)=>l+d.price*d.quantity,0),o=this.items.reduce((l,d)=>l+d.features.length*500,0),t=Math.round((e+o)*.18),n=e+o+t,r=document.getElementById("subtotal"),s=document.getElementById("features-total"),a=document.getElementById("tax"),i=document.getElementById("total"),c=document.getElementById("final-amount");r&&(r.textContent=`‚Çπ${e.toLocaleString()}`),s&&(s.textContent=`‚Çπ${o.toLocaleString()}`),a&&(a.textContent=`‚Çπ${t.toLocaleString()}`),i&&(i.textContent=`‚Çπ${n.toLocaleString()}`),c&&(c.textContent=n.toLocaleString())}bindEvents(){document.getElementById("delete-selected")?.addEventListener("click",()=>{this.deleteSelectedProject()}),document.getElementById("proceed-to-requirements")?.addEventListener("click",()=>{this.showProjectRequirements()}),document.getElementById("back-to-cart")?.addEventListener("click",()=>{this.backToCart()}),document.getElementById("back-to-requirements")?.addEventListener("click",()=>{this.backToRequirements()}),document.getElementById("final-proceed-to-payment")?.addEventListener("click",()=>{this.proceedToPayment()}),document.querySelectorAll('input[name="paymentMethod"]').forEach(e=>{e.addEventListener("change",o=>{this.switchPaymentMethod(o.target.value)})}),document.getElementById("final-payment")?.addEventListener("click",()=>{this.processFinalPayment()})}continueShopping(){this.items=[],this.saveCart(),window.location.href="/products"}deleteSelectedProject(){confirm("Are you sure you want to delete this project? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}async showProjectRequirements(){const e=document.getElementById("cart-actions"),o=document.getElementById("project-requirements");e&&e.classList.add("hidden"),o&&o.classList.remove("hidden"),this.prefillRequirementsForm(),this.showProjectTypeFields(),o?.scrollIntoView({behavior:"smooth"})}async submitRequirements(){console.log("üöÄ submitRequirements function called!");const e=document.getElementById("submit-requirements"),o=e.innerHTML;try{console.log("üöÄ Starting submitRequirements...");const t=document.getElementById("requirements-form");if(!t.checkValidity()){console.log("‚ùå Form validation failed"),t.reportValidity();return}console.log("‚úÖ Form validation passed"),e.innerHTML=`
          <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Saving & Processing...
        `,e.disabled=!0,this.requirements={projectName:t.querySelector('[name="projectName"]')?.value||"",contactPerson:t.querySelector('[name="contactPerson"]')?.value||"",restaurantName:t.querySelector('[name="restaurantName"]')?.value||"",cuisineType:t.querySelector('[name="cuisineType"]')?.value||"",appName:t.querySelector('[name="appName"]')?.value||"",productDescription:t.querySelector('[name="productDescription"]')?.value||"",email:t.querySelector('[name="email"]')?.value||"",phone:t.querySelector('[name="phone"]')?.value||"",additionalRequirements:t.querySelector('[name="additionalRequirements"]')?.value||""},console.log("üìù Collected form data:",this.requirements);let n=null;try{console.log("üîç Attempting to save to Supabase..."),n=await Promise.race([this.saveCartToSupabase(),new Promise((a,i)=>setTimeout(()=>i(new Error("Database timeout")),1e4))])}catch(a){console.warn("‚ö†Ô∏è Database save failed, but continuing:",a)}n?(console.log("‚úÖ Cart data saved successfully:",n),this.items.length>0&&(this.items[0].savedData=n,this.saveCart())):console.log("‚ö†Ô∏è No database save, but continuing with local data"),e.innerHTML=`
          <svg class="w-4 h-4 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Success! Redirecting...
        `,this.updateOrderReview();const r=document.getElementById("project-requirements"),s=document.getElementById("payment-section");if(console.log("üîÑ Showing payment page directly..."),console.log("üîç Project requirements element:",!!r),console.log("üîç Payment section element:",!!s),s&&(console.log("üîç Payment section parent:",s.parentElement),console.log("üîç Payment section offsetHeight:",s.offsetHeight),console.log("üîç Payment section offsetWidth:",s.offsetWidth),console.log("üîç Payment section computed style display:",window.getComputedStyle(s).display)),r&&(r.classList.add("hidden"),r.style.display="none",console.log("‚úÖ Hidden project requirements")),s){s.classList.remove("hidden"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("opacity","1","important"),s.style.setProperty("position","relative","important"),s.style.setProperty("z-index","999","important"),s.style.setProperty("height","auto","important"),s.style.setProperty("width","100%","important"),s.style.setProperty("background-color","#ffffff","important"),console.log("‚úÖ Showed payment section with forced visibility");const a=document.getElementById("payment-loading"),i=document.getElementById("payment-content");a&&(a.classList.remove("hidden"),a.style.display="block"),i&&(i.style.display="none"),this.updatePaymentSummary(),setTimeout(()=>{a&&(a.classList.add("hidden"),a.style.display="none"),i&&(i.style.display="block"),s.scrollIntoView({behavior:"smooth"}),console.log("‚úÖ Scrolled to payment page")},500)}else console.error("‚ùå Payment section element not found!"),alert("Error: Payment page not found. Please refresh the page and try again.");setTimeout(()=>{e.innerHTML=o,e.disabled=!1},2e3)}catch(t){console.error("‚ùå Error in submitRequirements:",t),e.innerHTML=`
          <svg class="w-4 h-4 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Error
        `,alert("Warning: Could not save to database, but you can still proceed with your order. Please contact support if this persists."),this.updateOrderReview();const n=document.getElementById("project-requirements"),r=document.getElementById("payment-section");if(n&&(n.classList.add("hidden"),n.style.display="none"),r){r.classList.remove("hidden"),r.style.setProperty("display","block","important"),r.style.setProperty("visibility","visible","important"),r.style.setProperty("opacity","1","important"),r.style.setProperty("position","relative","important"),r.style.setProperty("z-index","999","important"),r.style.setProperty("height","auto","important"),r.style.setProperty("width","100%","important"),r.style.setProperty("background-color","#ffffff","important");const s=document.getElementById("payment-loading"),a=document.getElementById("payment-content");s&&(s.classList.remove("hidden"),s.style.display="block"),a&&(a.style.display="none"),this.updatePaymentSummary(),setTimeout(()=>{s&&(s.classList.add("hidden"),s.style.display="none"),a&&(a.style.display="block"),r.scrollIntoView({behavior:"smooth"})},500)}setTimeout(()=>{e.innerHTML=o,e.disabled=!1},3e3)}}showProjectTypeFields(){if(this.items.length===0)return;const e=this.items[0];console.log("üîç Debug - Product ID:",e.id);const o=document.getElementById("app-name-fields"),t=document.getElementById("product-description-fields"),n=document.getElementById("restaurant-fields"),r=document.getElementById("restaurant-cuisine-fields");console.log("üîç Debug - Field elements found:",{appNameFields:!!o,productDescriptionFields:!!t,restaurantFields:!!n,restaurantCuisineFields:!!r});const s=document.getElementById("upload-label"),a=document.getElementById("upload-text"),i=document.getElementById("photos-label"),c=document.getElementById("photos-text");if(o?.classList.remove("hidden"),t?.classList.remove("hidden"),n?.classList.add("hidden"),r?.classList.add("hidden"),e.id==="restaurant-menu"||e.id==="restaurant-menu-system"||e.id==="restaurant-website"){console.log("üçï Showing restaurant fields for restaurant product:",e.id),n&&(n.classList.remove("hidden"),n.style.display="block"),r&&(r.classList.remove("hidden"),r.style.display="block"),console.log("üîç Debug - Restaurant fields visibility:",{restaurantFieldsHidden:n?.classList.contains("hidden"),restaurantCuisineFieldsHidden:r?.classList.contains("hidden"),restaurantFieldsDisplay:n?.style.display,restaurantCuisineFieldsDisplay:r?.style.display});const d=document.querySelector('input[name="restaurantName"]'),u=document.querySelector('select[name="cuisineType"]');d&&(d.required=!0),u&&(u.required=!0),s&&(s.textContent="Restaurant Logo"),a&&(a.textContent="Upload logo or drag and drop"),i&&(i.textContent="Menu Photos (Optional)"),c&&(c.textContent="Upload menu photos or drag and drop")}else console.log("üì± Showing non-restaurant fields for product:",e.id),r&&(r.classList.add("hidden"),r.style.display="none",console.log("üö´ Cuisine type field hidden for non-restaurant product")),e.id==="android-tv"||e.id==="android-tv-app"?(console.log("üì∫ Showing TV app fields"),s&&(s.textContent="App Icon"),a&&(a.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),c&&(c.textContent="Upload app screenshots or drag and drop")):e.id==="mobile-streaming"||e.id==="streaming-mobile-app"?(console.log("üì± Showing mobile app fields"),s&&(s.textContent="App Icon"),a&&(a.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),c&&(c.textContent="Upload app screenshots or drag and drop")):(s&&(s.textContent="App Icon"),a&&(a.textContent="Upload app icon or drag and drop"),i&&(i.textContent="App Screenshots (Optional)"),c&&(c.textContent="Upload app screenshots or drag and drop"));const l=document.querySelector('input[name="appName"]');l&&(l.required=!0)}prefillRequirementsForm(){const o=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!o)return;const t=document.querySelector('input[name="email"]'),n=document.querySelector('input[name="phone"]');t&&(t.value=o.email||""),n&&(n.value=o.phone||""),this.setupFileUploads()}setupFileUploads(){const e=document.getElementById("logo-upload");e&&e.addEventListener("change",t=>{const n=t.target.files[0];n&&(this.showUploadSuccess("logo-upload",n.name),this.items.length>0&&(this.items[0].logo=n,console.log("Logo stored:",n.name)))});const o=document.getElementById("menu-upload");o&&o.addEventListener("change",t=>{const n=Array.from(t.target.files);n.length>0&&(this.showUploadSuccess("photos-upload",`${n.length} files selected`),this.items.length>0&&(this.items[0].photos=n,console.log("Photos stored:",n.map(r=>r.name))))}),this.setupDragAndDrop()}setupFormChangeListeners(){console.log("üö´ Auto-save disabled to prevent duplicate entries")}setupDragAndDrop(){const e=document.querySelector("#logo-upload-section .border-dashed"),o=document.querySelector("#photos-upload-section .border-dashed");e&&(e.addEventListener("dragover",t=>{t.preventDefault(),e.classList.add("border-primary-400","bg-primary-50")}),e.addEventListener("dragleave",t=>{t.preventDefault(),e.classList.remove("border-primary-400","bg-primary-50")}),e.addEventListener("drop",t=>{t.preventDefault(),e.classList.remove("border-primary-400","bg-primary-50");const n=Array.from(t.dataTransfer.files);if(n.length>0){const r=n[0];document.getElementById("logo-upload").files=t.dataTransfer.files,this.showUploadSuccess("logo-upload",r.name),this.items.length>0&&(this.items[0].logo=r)}})),o&&(o.addEventListener("dragover",t=>{t.preventDefault(),o.classList.add("border-primary-400","bg-primary-50")}),o.addEventListener("dragleave",t=>{t.preventDefault(),o.classList.remove("border-primary-400","bg-primary-50")}),o.addEventListener("drop",t=>{t.preventDefault(),o.classList.remove("border-primary-400","bg-primary-50");const n=Array.from(t.dataTransfer.files);n.length>0&&(document.getElementById("menu-upload").files=t.dataTransfer.files,this.showUploadSuccess("photos-upload",`${n.length} files selected`),this.items.length>0&&(this.items[0].photos=n))}))}showUploadSuccess(e,o){const t=document.getElementById(e==="logo-upload"?"upload-status":"photos-status");t&&(t.textContent=`‚úì ${o}`,t.className="mt-3 text-sm font-medium text-green-600",t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("hidden")},3e3))}backToCart(){const e=document.getElementById("project-requirements"),o=document.getElementById("cart-actions");e&&e.classList.add("hidden"),o&&o.classList.remove("hidden"),o?.scrollIntoView({behavior:"smooth"})}async saveCartToSupabase(){try{console.log("üîç Starting saveCartToSupabase...");const e=window.globalAuthManager||window.simpleAuthManager;console.log("üîç Auth manager found:",!!e);const o=e?.getCurrentUser();if(console.log("üîç Current user:",o),!o||this.items.length===0)return console.log("‚ùå No user or items found for Supabase save"),console.log("‚ùå User:",o),console.log("‚ùå Items length:",this.items.length),null;const t=this.items[0];if(console.log("üîç Debug - Item being saved:",t),console.log("üîç Debug - Current user:",o),!v)return console.error("‚ùå Supabase client not available"),null;const n=document.getElementById("requirements-form");let r={};n&&(r={projectName:n.querySelector('[name="projectName"]')?.value||"",contactPerson:n.querySelector('[name="contactPerson"]')?.value||"",restaurantName:n.querySelector('[name="restaurantName"]')?.value||"",cuisineType:n.querySelector('[name="cuisineType"]')?.value||n.querySelector('[name="emergencyCuisineType"]')?.value||"",appName:n.querySelector('[name="appName"]')?.value||"",email:n.querySelector('[name="email"]')?.value||"",phone:n.querySelector('[name="phone"]')?.value||"",additionalRequirements:n.querySelector('[name="additionalRequirements"]')?.value||""});const s=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",a=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",i=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",c=document.querySelector('input[name="textColor"]')?.value||"#1F2937",l={user_email:o.email,product_id:t.id,product_name:t.name,product_description:t.description,base_price:t.price,custom_name:t.customName||"",restaurant_name_customization:t.restaurantName||"",selected_color:t.color||"#3B82F6",selected_features:t.features||[],project_name:r.projectName||"",contact_person:r.contactPerson||"",restaurant_name:r.restaurantName||"",cuisine_type:r.cuisineType||"",app_name:r.appName||"",product_description_custom:r.productDescription||"",contact_email:r.email||o.email,contact_phone:r.phone||o.phone||"",primary_color:s,secondary_color:a,accent_color:i,text_color:c,additional_requirements:r.additionalRequirements||"",cart_status:"active",is_checkout_initiated:!1};console.log("üîç Debug - Cart data being sent to Supabase:",l),console.log("üîç Testing Supabase connection...");const{data:d,error:u}=await v.from("cart_customizations").select("id").limit(1);if(u)return console.error("‚ùå Supabase connection test failed:",u),null;console.log("‚úÖ Supabase connection test successful"),console.log("üöÄ Attempting to save to Supabase...");const{data:m,error:p}=await v.from("cart_customizations").upsert([l],{onConflict:"user_email,product_id"}).select();return p?(console.error("‚ùå Error saving cart to Supabase:",p),console.error("‚ùå Error details:",{code:p.code,message:p.message,details:p.details,hint:p.hint}),null):(console.log("‚úÖ Successfully saved to Supabase:",m),m[0])}catch(e){return console.error("‚ùå Error in saveCartToSupabase:",e),console.error("‚ùå Error stack:",e.stack),null}}calculateTotal(){const e=this.items.reduce((n,r)=>n+r.price*r.quantity,0),o=this.items.reduce((n,r)=>{const s={responsive:500,seo:300,analytics:200};return n+r.features.reduce((a,i)=>a+(s[i]||0),0)},0),t=(e+o)*.18;return Math.round(e+o+t)}declineOrder(){confirm("Are you sure you want to decline this order? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}deleteItem(){confirm("Are you sure you want to delete this item? You will be redirected to products page.")&&(this.items=[],this.saveCart(),window.location.href="/products")}switchPaymentMethod(e){const o=document.getElementById("card-details"),t=document.getElementById("upi-details"),n=document.getElementById("netbanking-details");switch(o?.classList.add("hidden"),t?.classList.add("hidden"),n?.classList.add("hidden"),e){case"card":o?.classList.remove("hidden");break;case"upi":t?.classList.remove("hidden");break;case"netbanking":n?.classList.remove("hidden");break}}updateOrderReview(){console.log("üîÑ Updating order review with data:",this.requirements);try{const e=document.getElementById("review-project-name"),o=document.getElementById("review-contact-person"),t=document.getElementById("review-app-name");e&&(e.textContent=this.requirements.projectName||"-"),o&&(o.textContent=this.requirements.contactPerson||"-"),t&&(t.textContent=this.requirements.appName||"-");const n=this.items[0],r=document.getElementById("review-restaurant-info"),s=document.getElementById("review-cuisine-info"),a=document.getElementById("review-restaurant-name"),i=document.getElementById("review-cuisine-type");n&&(n.id==="restaurant-menu"||n.id==="restaurant-menu-system"||n.id==="restaurant-website")?(r&&r.classList.remove("hidden"),s&&s.classList.remove("hidden"),a&&(a.textContent=this.requirements.restaurantName||"-"),i&&(i.textContent=this.requirements.cuisineType||"-")):(r&&r.classList.add("hidden"),s&&s.classList.add("hidden"));const c=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",l=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",d=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",u=document.querySelector('input[name="textColor"]')?.value||"#1F2937",m=document.getElementById("review-primary-color"),p=document.getElementById("review-secondary-color"),b=document.getElementById("review-accent-color"),E=document.getElementById("review-text-color");m&&(m.style.backgroundColor=c),p&&(p.style.backgroundColor=l),b&&(b.style.backgroundColor=d),E&&(E.style.backgroundColor=u);const S=document.getElementById("logo-upload")?.files[0],g=document.getElementById("menu-upload")?.files,C=document.getElementById("review-logo-status"),q=document.getElementById("review-photos-status");C&&(C.textContent=S?`‚úì ${S.name}`:"Not uploaded"),q&&(q.textContent=g&&g.length>0?`‚úì ${g.length} photos selected`:"Not uploaded");const I=document.getElementById("review-total");if(I){const f=this.calculateTotal();I.textContent=`‚Çπ${f.toLocaleString()}`}const w=document.getElementById("final-amount");if(w){const f=this.calculateTotal();w.textContent=f.toLocaleString()}const L=document.getElementById("review-email"),x=document.getElementById("review-phone");L&&(L.textContent=this.requirements.email||"-"),x&&(x.textContent=this.requirements.phone||"-");const B=document.getElementById("review-additional-requirements");B&&(B.textContent=this.requirements.additionalRequirements||"No additional requirements specified"),console.log("‚úÖ Order review updated successfully")}catch(e){console.error("‚ùå Error updating order review:",e)}}backToRequirements(){const e=document.getElementById("order-review"),o=document.getElementById("project-requirements");e&&e.classList.add("hidden"),o&&o.classList.remove("hidden"),o?.scrollIntoView({behavior:"smooth"})}async proceedToPayment(){await this.createOrder(),this.showPaymentSection()}showPaymentSection(){const e=document.getElementById("project-requirements"),o=document.getElementById("payment-section");e&&e.classList.add("hidden"),o&&o.classList.remove("hidden"),this.updatePaymentSummary(),o?.scrollIntoView({behavior:"smooth"})}updatePaymentSummary(){try{console.log("üîÑ Updating payment summary..."),console.log("üìù Requirements data:",this.requirements);const e=document.getElementById("payment-project-name"),o=document.getElementById("payment-contact-person"),t=document.getElementById("payment-app-name"),n=document.getElementById("payment-email"),r=document.getElementById("payment-phone"),s=document.getElementById("payment-total-amount");if(console.log("üîç Payment elements found:",{projectNameEl:!!e,contactPersonEl:!!o,appNameEl:!!t,emailEl:!!n,phoneEl:!!r,totalAmountEl:!!s}),e&&(e.textContent=this.requirements.projectName||"-",console.log("‚úÖ Updated project name:",this.requirements.projectName)),o&&(o.textContent=this.requirements.contactPerson||"-",console.log("‚úÖ Updated contact person:",this.requirements.contactPerson)),t&&(t.textContent=this.requirements.appName||"-",console.log("‚úÖ Updated app name:",this.requirements.appName)),n&&(n.textContent=this.requirements.email||"-",console.log("‚úÖ Updated email:",this.requirements.email)),r&&(r.textContent=this.requirements.phone||"-",console.log("‚úÖ Updated phone:",this.requirements.phone)),s){const i=this.calculateTotal();s.textContent=i.toLocaleString(),console.log("‚úÖ Updated total amount:",i)}const a=document.getElementById("final-amount");if(a){const i=this.calculateTotal();a.textContent=i.toLocaleString(),console.log("‚úÖ Updated final payment amount:",i)}console.log("‚úÖ Payment summary updated successfully")}catch(e){console.error("‚ùå Error updating payment summary:",e)}}processFinalPayment(){const e=document.querySelector('input[name="paymentMethod"]:checked')?.value;if(!e){alert("Please select a payment method");return}let o=!0,t="";switch(e){case"card":const n=document.querySelector('input[name="cardNumber"]').value,r=document.querySelector('input[name="cardholderName"]').value,s=document.querySelector('input[name="expiryDate"]').value,a=document.querySelector('input[name="cvv"]').value;(!n||!r||!s||!a)&&(o=!1,t="Please fill in all card details");break;case"upi":document.querySelector('input[name="upiId"]').value||(o=!1,t="Please enter your UPI ID");break;case"netbanking":document.querySelector('select[name="bank"]').value||(o=!1,t="Please select your bank");break}if(!o){alert(t);return}this.simulatePayment()}simulatePayment(){const e=document.getElementById("final-payment");e.innerHTML,e.innerHTML=`
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing Payment...
      `,e.disabled=!0,setTimeout(()=>{this.saveOrderToHistory(),this.updateOrderStatusToConfirmed(),this.items=[],this.saveCart(),e.innerHTML=`
          <svg class="w-5 h-5 text-white inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Payment Successful!
        `,setTimeout(()=>{window.location.href="/orders?order=success"},2e3)},3e3)}saveOrderToHistory(){if(this.items.length===0)return;const e=AuthGuard.getCurrentUser();if(!e)return;const o=this.items[0],t=this.calculateTotal(),n=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",r=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",s=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",a=document.querySelector('input[name="textColor"]')?.value||"#1F2937",i={userId:e.email,customerName:e.fullName||"User",customerEmail:e.email,serviceName:o.name,serviceType:"web_development",status:"cart",paymentStatus:"pending",amount:t,currency:"INR",requirements:{primaryColor:n,secondaryColor:r,accentColor:s,textColor:a,customName:o.customName||"",logo:o.logo||null,features:o.features||[],description:o.description}};try{const u=h.createOrder(i);console.log("Order saved to shared store:",u),this.currentSharedOrderId=u.id;const m=h.getOrders();console.log("All orders in shared store after creation:",m),console.log("Current shared order ID:",this.currentSharedOrderId)}catch(u){console.error("Error saving to shared store:",u)}const c={orderId:`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,userId:e.email,projectName:o.name,description:o.description,total:t,orderDate:new Date().toISOString(),requirements:{...this.requirements,primaryColor:n,secondaryColor:r,accentColor:s,textColor:a},features:o.features||[],logo:o.logo||null,color:o.color||"#3B82F6",customName:o.customName||""};let l=[];const d=localStorage.getItem("user-orders");d&&(l=JSON.parse(d)),l.push(c),localStorage.setItem("user-orders",JSON.stringify(l)),console.log("Order saved to user orders:",c),console.log("All user orders:",l)}async createOrder(){if(this.items.length===0)return;const o=(window.globalAuthManager||window.simpleAuthManager)?.getCurrentUser();if(!o)return;const t=this.items[0],n=this.calculateTotal(),r=document.querySelector('input[name="primaryColor"]')?.value||"#3B82F6",s=document.querySelector('input[name="secondaryColor"]')?.value||"#A5CF6",a=document.querySelector('input[name="accentColor"]')?.value||"#F59E0B",i=document.querySelector('input[name="textColor"]')?.value||"#1F2937",c=document.getElementById("requirements-form");c&&(c.querySelector('[name="projectName"]')?.value,c.querySelector('[name="contactPerson"]')?.value,c.querySelector('[name="restaurantName"]')?.value,c.querySelector('[name="cuisineType"]')?.value,c.querySelector('[name="appName"]')?.value,c.querySelector('[name="productDescription"]')?.value,c.querySelector('[name="email"]')?.value,c.querySelector('[name="phone"]')?.value,c.querySelector('[name="additionalRequirements"]')?.value);try{const l=await this.saveCartToSupabase();l?(console.log("‚úÖ Cart customization saved to Supabase:",l),this.currentSharedOrderId=l.id):console.error("‚ùå Failed to save cart data to Supabase");const d={userId:o.email,customerName:o.fullName||"User",customerEmail:o.email,serviceName:t.name,serviceType:"web_development",status:"pending",paymentStatus:"pending",amount:n,currency:"INR",requirements:{primaryColor:r,secondaryColor:s,accentColor:a,textColor:i,customName:t.customName||"",logo:t.logo||null,features:t.features||[],description:t.description}},u=h.createOrder(d);console.log("Order created in shared store:",u);const m=h.getOrders();console.log("All orders in shared store after creation:",m),console.log("Current shared order ID:",this.currentSharedOrderId)}catch(l){console.error("Error creating order:",l)}}updateOrderStatusToPending(){if(this.currentSharedOrderId)try{h.updateOrderStatus(this.currentSharedOrderId,"pending","Payment initiated"),console.log("Order status updated to pending")}catch(e){console.error("Error updating order status:",e)}}updateOrderStatusToConfirmed(){if(this.currentSharedOrderId)try{h.updateOrderStatus(this.currentSharedOrderId,"confirmed","Payment successful - Order confirmed"),console.log("Order status updated to confirmed")}catch(e){console.error("Error updating order status:",e)}}debounce(e,o){let t;return function(...r){const s=()=>{clearTimeout(t),e(...r)};clearTimeout(t),t=setTimeout(s,o)}}}document.addEventListener("DOMContentLoaded",()=>{console.log("üöÄ DOM Content Loaded - Starting cart initialization...");try{const y=new P;console.log("‚úÖ Cart initialized successfully"),console.log("üîç Setting up event listeners...");const e=document.getElementById("submit-requirements");console.log("üîç Submit button found:",!!e),e?.addEventListener("click",t=>{console.log("üöÄ Submit button clicked!"),t.preventDefault(),t.stopPropagation(),y.submitRequirements()}),document.getElementById("requirements-form")?.addEventListener("submit",t=>(console.log("üö´ Form submission prevented"),t.preventDefault(),t.stopPropagation(),!1)),console.log("‚úÖ Event listeners set up successfully")}catch(y){console.error("‚ùå Error initializing cart:",y),alert("Error initializing cart: "+y.message)}});
