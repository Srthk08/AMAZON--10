import"./StandaloneAdminLayout.astro_astro_type_script_index_0_lang.CiBD5cOw.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2";import"https://cdn.tailwindcss.com/3.4.0";const u="https://lmrrdcaavwwletcjcpqv.supabase.co",p="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtcnJkY2Fhdnd3bGV0Y2pjcHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDQ0ODgsImV4cCI6MjA3MTA4MDQ4OH0.AU59Qfr6K9i880Gcn5y-3pjCf8PXsDIq4OI0-lPQVuQ";let i=null;function s(){return new Promise(e=>{window.supabase?(i=window.supabase.createClient(u,p),e(i)):setTimeout(()=>s().then(e),100)})}document.addEventListener("DOMContentLoaded",async()=>{console.log("ðŸ”„ Loading admin profile..."),await f(),await g(),await y(),h()});async function f(){try{console.log("ðŸ”„ Loading admin info..."),i||await s();const{data:{user:e},error:o}=await i.auth.getUser();if(o){console.error("Error getting user:",o);return}if(e){const{data:n,error:r}=await i.from("profiles").select("*").eq("id",e.id).single();if(r)console.error("Error getting profile:",r),document.getElementById("admin-full-name").textContent=e.user_metadata?.full_name||"Admin User",document.getElementById("admin-email").textContent=e.email||"No email";else{document.getElementById("admin-full-name").textContent=n.full_name||"Admin User",document.getElementById("admin-email").textContent=n.email||e.email||"No email",document.getElementById("admin-display-name").textContent=n.full_name||"Admin User",document.getElementById("admin-display-email").textContent=n.email||e.email||"No email";const a=document.getElementById("admin-avatar-large");if(a){const t=n.full_name||e.user_metadata?.full_name||e.email||"A";a.textContent=t.charAt(0).toUpperCase()}n.created_at&&(document.getElementById("admin-created-at").textContent=new Date(n.created_at).toLocaleDateString()),e.last_sign_in_at&&(document.getElementById("admin-last-login").textContent=new Date(e.last_sign_in_at).toLocaleDateString())}}else document.getElementById("admin-full-name").textContent="No user logged in",document.getElementById("admin-email").textContent="No email"}catch(e){console.error("Error loading admin info:",e)}}async function g(){try{console.log("ðŸ”„ Loading admin stats..."),i||await s();const[e,o,n,r]=await Promise.all([i.from("profiles").select("*",{count:"exact",head:!0}),i.from("contact_submissions").select("*",{count:"exact",head:!0}),i.from("support_tickets").select("*",{count:"exact",head:!0}),i.from("cart_customizations").select("*",{count:"exact",head:!0})]),a=e.count||0,t=o.count||0,l=n.count||0,m=r.count||0;document.getElementById("orders-managed").textContent=m.toString(),document.getElementById("users-managed").textContent=a.toString(),document.getElementById("tickets-resolved").textContent=l.toString(),document.getElementById("contact-forms").textContent=t.toString(),console.log("âœ… Admin stats loaded:",{totalUsers:a,totalContacts:t,totalTickets:l,totalCarts:m})}catch(e){console.error("Error loading admin stats:",e)}}async function y(){const e=document.getElementById("recent-activity");if(e)try{console.log("ðŸ”„ Loading recent activity..."),i||await s();const[o,n,r]=await Promise.all([i.from("contact_submissions").select("*").order("created_at",{ascending:!1}).limit(3),i.from("support_tickets").select("*").order("created_at",{ascending:!1}).limit(3),i.from("cart_customizations").select("*").order("created_at",{ascending:!1}).limit(3)]),a=[];if(o.data&&o.data.forEach(t=>{a.push({type:"contact",icon:"user-plus",color:"green",title:"New Contact Submission",description:`${t.first_name} ${t.last_name} - ${t.project_type||"General Inquiry"}`,time:new Date(t.created_at).toLocaleDateString()})}),n.data&&n.data.forEach(t=>{a.push({type:"ticket",icon:"question-mark-circle",color:"yellow",title:`Support Ticket ${t.status||"New"}`,description:`${t.subject||"No subject"} - ${t.category||"General"}`,time:new Date(t.created_at).toLocaleDateString()})}),r.data&&r.data.forEach(t=>{a.push({type:"cart",icon:"shopping-cart",color:"blue",title:"New Cart Customization",description:`${t.project_name||"Custom Project"} - â‚¹${t.total_amount||"0"}`,time:new Date(t.created_at).toLocaleDateString()})}),a.sort((t,l)=>new Date(l.time).getTime()-new Date(t.time).getTime()),a.splice(5),a.length===0){e.innerHTML=`
          <div class="text-center py-8 text-gray-500">
            <p>No recent activity</p>
          </div>
        `;return}e.innerHTML=a.map(t=>`
        <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
          <div class="w-8 h-8 bg-${t.color}-100 rounded-full flex items-center justify-center">
            <svg class="w-4 h-4 text-${t.color}-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              ${E(t.icon)}
            </svg>
          </div>
          <div class="flex-1">
            <p class="text-sm font-medium text-gray-900">${t.title}</p>
            <p class="text-sm text-gray-500">${t.description}</p>
          </div>
          <span class="text-sm text-gray-400">${t.time}</span>
        </div>
      `).join(""),console.log("âœ… Recent activity loaded:",a.length,"activities")}catch(o){console.error("Error loading recent activity:",o),e.innerHTML=`
        <div class="text-center py-8 text-gray-500">
          <p>Error loading recent activity</p>
        </div>
      `}}function E(e){switch(e){case"shopping-cart":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>';case"question-mark-circle":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';case"user-plus":return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>';default:return'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}}function h(){const e=document.getElementById("edit-profile-btn"),o=document.getElementById("edit-profile-modal"),n=document.getElementById("close-modal"),r=document.getElementById("cancel-edit"),a=document.getElementById("edit-profile-form");e&&e.addEventListener("click",I),n&&n.addEventListener("click",d),r&&r.addEventListener("click",d),a&&a.addEventListener("submit",v),o&&o.addEventListener("click",t=>{t.target===o&&d()})}function I(){const e=document.getElementById("edit-profile-modal"),o=document.getElementById("edit-full-name"),n=document.getElementById("edit-email"),r=document.getElementById("edit-phone"),a=document.getElementById("admin-full-name").textContent,t=document.getElementById("admin-email").textContent;o&&(o.value=a),n&&(n.value=t),r&&(r.value=""),e&&e.classList.remove("hidden")}function d(){const e=document.getElementById("edit-profile-modal");e&&e.classList.add("hidden")}async function v(e){e.preventDefault();const o=document.getElementById("edit-full-name").value,n=document.getElementById("edit-phone").value;try{i||await s();const{data:{user:r},error:a}=await i.auth.getUser();if(a||!r){c("Error: User not found","error");return}const{error:t}=await i.from("profiles").update({full_name:o,phone:n||null,updated_at:new Date().toISOString()}).eq("id",r.id);if(t){console.error("Error updating profile:",t),c("Error updating profile","error");return}document.getElementById("admin-full-name").textContent=o,document.getElementById("admin-display-name").textContent=o;const l=document.getElementById("admin-avatar-large");l&&(l.textContent=o.charAt(0).toUpperCase()),c("Profile updated successfully!","success"),d()}catch(r){console.error("Error updating profile:",r),c("Error updating profile","error")}}function c(e,o="info"){const n=document.createElement("div");n.className=`fixed top-4 right-4 px-6 py-3 rounded-md text-white z-50 ${o==="success"?"bg-green-600":o==="error"?"bg-red-600":"bg-blue-600"}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}
